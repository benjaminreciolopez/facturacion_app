{% extends "base.html" %} {% block content %} {% if
request.query_params.get("error") %}
<div class="alert alert-danger">{{ request.query_params.get("error") }}</div>
{% endif %} {% if request.query_params.get("ok") %}
<div class="alert alert-success">{{ request.query_params.get("ok") }}</div>
{% endif %}

<h2>Configuración de Tipos de IVA</h2>

<form method="post" action="/configuracion/iva/create" class="row g-3 mb-4">
  <div class="col-md-2">
    <label class="form-label">IVA (%)</label>
    <input
      type="number"
      step="0.1"
      name="porcentaje"
      class="form-control"
      required
    />
  </div>

  <div class="col-md-4">
    <label class="form-label">Descripción</label>
    <input type="text" name="descripcion" class="form-control" />
  </div>

  <div class="col-md-2 d-flex align-items-end">
    <button class="btn btn-primary w-100">Añadir</button>
  </div>
</form>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>IVA %</th>
      <th>Descripción</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for iva in ivas %}
    <tr>
      <td>{{ iva.porcentaje }}</td>
      <td>{{ iva.descripcion }}</td>
      <td>
        <a
          href="/configuracion/iva/{{ iva.id }}/delete"
          class="btn btn-sm btn-danger"
        >
          Eliminar
        </a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
  <script>
    function esMovil() {
      return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(
        navigator.userAgent
      );
    }

    function bloquearIVAenMovil() {
      if (!esMovil()) return;

      // Bloquear inputs
      document.querySelectorAll("input, select, textarea").forEach((el) => {
        el.setAttribute("disabled", "disabled");
      });

      // Bloquear botones
      document.querySelectorAll("button, .btn, a.btn").forEach((btn) => {
        btn.setAttribute("disabled", "disabled");
        btn.style.opacity = "0.6";
        btn.style.pointerEvents = "none";
      });

      // Aviso
      const aviso = document.createElement("div");
      aviso.style.background = "#ffb200";
      aviso.style.padding = "12px";
      aviso.style.marginBottom = "10px";
      aviso.style.borderRadius = "6px";
      aviso.style.fontWeight = "bold";
      aviso.innerText =
        "La configuración de tipos de IVA solo puede modificarse desde un ordenador. En móvil el modo es solo lectura.";

      const header = document.querySelector("h1, h2");
      if (header) header.before(aviso);
    }

    document.addEventListener("DOMContentLoaded", bloquearIVAenMovil);
  </script>
</table>

{% endblock %}
